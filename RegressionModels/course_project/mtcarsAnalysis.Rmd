---
title: 'Modeling Fuel Consumption in (''73-''74) Automobiles: Automatic vs. Manual
  Transmission.'
author: "Mark Susol, mock writer for US Motor Trend Magazine"
date: "21 January, 2015"
output:
  html_document: default
  pdf_document:
    fig_crop: no
---
In this analysis, we aim to examine the fuel consumption of 1973–74 model automobiles as it relates to different aspects of automobile design and performance. The main factor around which we will categorize the analysis will be the type of transmission, automatic or manual. Dependency on the remaining design aspects will be further evaluated to look to quantify the differences observed, if any, in fuel consumption between transmission types.

**EXPLORATORY DATA ANALYSIS**

The data is part of [R's datasets package](https://stat.ethz.ch/R-manual/R-patched/library/datasets/html/mtcars.html) that was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models). The type of transmission, Automatic vs Manual, will be used as a Factor variable in the analysis. We are interested in modeling how the remaining design aspects possibly affect the fuel consumption, characterized by the Miles per Gallon (MPG).

```{r , echo=FALSE}
# prepare the data for the .Rmd
data(mtcars)
mtcars$am <- factor(mtcars$am, levels=c(0,1), labels=c("Automatic","Manual"))
fit <- lm(mpg ~ ., data=mtcars)
```

First, a **Variance Inflation Factor (VIF)** test is performed to quantify multicolinearity, and evaluate how these independent variables affect the coefficient estimates. The model will be fitted using all the independent variables with MPG as the factor variable. The higher results of the VIF should provide for better candidates for forming a model.

```{r , echo=FALSE}
library(car)
vif(fit)
```

From the results, it shows that independent variables CYL, DISP, HP and WT should be further evaluated for inclusion in our model. For the sake of simplicity in this exercise, CYL & DISP will be dropped in favor of HP as a measure of the "power" to the road of the automobile. Out of being purely curious about this design aspect, QSEC will be considered for regression as well.A plot of the possible independent design aspects WT, HP, & QSEC (**Figure 1**) validates the possible inclusion of these variables for consideration. 

Plotting the single regression of MPG on each of the possible variables (**Figure 2**) for modeling shows that in fact we have reason to investigate further. We see that there is a clear difference in fuel consumption for each variable on its own. It is also important to recognize the interaction between the factor variable, transmission type, and the independent variables WT & QSEC. This is shown by the difference in intercepts AND slopes, where as the slope for HP remains the same regardless of transmission type.

**MODEL SELECTION**

Several model were considered where the independent variables weight (WT), horse power (HP), and quarter mile acceleration (QSEC) were added in succession to the model. The ANOVA test (**Figure 3**) shows that the model that includes WT + HP + QSEC is a significant model for consideration. However the model is only marginally improved by adding QSEC to the model.

It is important to note that from revisiting **Figure 2** and evaluating the slope and intercept as a factor of transmission type, we see that there is an interaction between the factor and the variables (WT & QSEC). So the model will have to include the interaction variables **factor(am) wt** & **factor(am) qsec**, if these independent variables are included in the model.

The correlation between the possible independent variables are presented below. QSEC appears to be uncorrelated to either WT or HP. Addition of QSEC to the model will negatively impact the model, as it might be affecting WT & HP's influence on MPG. QSEC will be removed from the suggested regression model.
```{r, echo=FALSE}
d <- data.frame(c(cor(mtcars$wt,mtcars$hp)),c(cor(mtcars$wt,mtcars$qsec)), cor(mtcars$hp,mtcars$qsec))
names(d) <- c("cor(wt,hp)","cor(wt,qsec)","cor(hp,qsec)")
print(d)
``` 

The independent variables WT & HP with interaction variable **factor(am) wt** will be used in the regression model with the transmission type (am) as the factor. A summary of the linear model in the Appendix (**Figure 4**) shows the model stats as well as the coefficients for the model. A final check on the residuals (**Figure 5**) shows that we have a normal distribution and non-Heteroskedacity.

The regression model selected will have the formula:
$$ factor(am) + wt + factor(am) wt + hp - 1 $$

```{r, echo=FALSE}
# will set the fit here since it may need to be changed in this section. define only once in .Rmd
fit <- lm(mpg ~ factor(am) + wt + factor(am)*wt + hp - 1, data=mtcars)

# custom fnction to get at p-value
lmp <- function (modelobject) {
    if (class(modelobject) != "lm") stop("Not an object of class 'lm' ")
    f <- summary(modelobject)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)
}

# create vars for printing the coefficients
b0.0  <- signif(summary(fit)$coef[1], digits = 4)
b0.1  <- signif(summary(fit)$coef[2], digits = 4)
bwt.0 <- signif(summary(fit)$coef[3], digits = 3)
bhp   <- signif(summary(fit)$coef[4], digits = 1)
bwt.1 <- signif(summary(fit)$coef[5], digits = 1)
# calculate change in hp for 1.0 mpg change
dhp <- abs(signif(1/bhp, digits=3))
```

**CONCLUSION**

We have concluded that there is in fact a quantifiable difference in fuel consumption between manual and automatic transmissions in the models studied. The model selected was determined to have a $R^2 = `r summary(fit)$r.squared`$ and a $p-value = `r lmp(fit)`$ which suggests that it accounts for the significant variance in the data.

The model can be presented as:
$$ E[mpg]Automatic =  `r b0.0` + `r bwt.0` * wt + `r bhp` * hp $$
$$ E[mpg]Manual    =  `r b0.1` + `r bwt.0 + bwt.1` * wt + `r bhp` * hp $$

We can infer from this model that:

- for every 1000 lb increase in weight, we expect a `r abs(bwt.0)` (`r abs(bwt.0 + bwt.1)`) decrease in MPG for an Automatic (Manual) transmission, holding all other variables constant.
- for every `r dhp` increase in hp, we expect a 1.0 decrease in MPG for either transmission, holding all other variables constant.

```{r, echo=FALSE}
## should use a predict function using fit, but time is running short.
# class A: lighter, sport
mpg_aA <- b0.0 + bwt.0*2 - bhp*300
mpg_aM <- b0.1 + (bwt.0 + bwt.1)*2 - bhp*300

# class B: heavier, non-sport
mpg_bA <- b0.0 + bwt.0*5 - bhp*150
mpg_bM <- b0.1 + (bwt.0 + bwt.1)*5 - bhp*150
```
Which transmission is better for fuel consumption, depends on the model and specific design aspects involved. If you classify the models into **class A:** lighter, sport (high hp) & **class B:** heavier, work (low hp), then the model will predict that:

- **class A:**  mpg (wt=2000 lbs, hp=300) = ```r mpg_aA``` Automatic :: **```r mpg_aM``` Manual**
- **class B:**  mpg (wt=5000 lbs, hp=150) = **```r mpg_bA``` Automatic** :: ```r mpg_bM``` Manual

\pagebreak

**APPENDIX**
```{r , echo=FALSE}
# note: knitr-PDF only: fig.align=left does not work. use \centering
```
\centering

**Figure 1: Plot of possible independent design aspects.**
```{r , echo=FALSE}
pairs(~mpg+wt+hp+qsec, pch = 21, lower.panel=NULL,
      bg = c("salmon", "lightblue")[unclass(mtcars$am)], data=mtcars)
```

**Figure 2: Regression of MPG on selected design aspects.**
```{r, fig.width=7,fig.height=3.5, echo=FALSE}
## ex: http://www.statmethods.net/advgraphs/ggplot2.html
## http://docs.ggplot2.org/current/geom_abline.html
library(ggplot2)
library(grid)
library(gridExtra)

plot1 <- qplot(hp, mpg, data=mtcars, geom=c("point", "smooth"), 
               method="lm", formula=y~x, color=am, ylim=c(5,35),
               xlab="Horse Power", ylab="Miles per Gallon (MPG)"
               ) + theme(legend.position = "none")

plot2 <- qplot(qsec, mpg, data=mtcars, geom=c("point", "smooth"), 
               method="lm", formula=y~x, color=am, ylim=c(5,35),
               xlab="Quarter Mile Acceleration", ylab="Miles per Gallon (MPG)"
               ) + theme(legend.position = "none")

plot3 <- qplot(wt, mpg, data=mtcars, geom=c("point", "smooth"), 
               method="lm", formula=y~x, color=am, ylim=c(5,35), 
               xlab="Weight (x1000lbs)", ylab="Miles per Gallon (MPG)"
               ) + theme(legend.position = c(0.85, 0.9))

grid.arrange(plot1, plot2, plot3, nrow=1, ncol=3)
```

\pagebreak

**Figure 3: Analysis of Variance in Possible Models.**
```{r, echo=FALSE}
fit1 <- lm(mpg ~ factor(am) + wt - 1, data=mtcars)
fit2 <- update(fit1, mpg ~ factor(am) + wt + factor(am)*wt -1)
fit3 <- update(fit1, mpg ~ factor(am) + wt + factor(am)*wt + hp -1)
fit4 <- update(fit1, mpg ~ factor(am) + wt + factor(am)*wt + hp + qsec + factor(am)*qsec -1)
anova(fit1,fit2,fit3,fit4)
```

**Figure 4: Summary of our Selected Regression Model.**
```{r, echo=FALSE}
summary(fit)
```

\pagebreak

**Figure 5: Residuals for our Selected Regression Model.**
```{r, echo=FALSE}
par(mfrow = c(2,2))
plot(fit)
```

**Source File for this report found at [https://github.com/msusol/JHUDataScience](https://github.com/msusol/JHUDataScience/blob/master/RegressionModels/course_project/mtcarsAnalysis.Rmd)**

**© Mark Susol, completed for a Coursera Class Assignment in [Regression Models](https://class.coursera.org/regmods-010)**